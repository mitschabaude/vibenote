# Example NGINX config for VibeNote API reverse proxy
# Copy to /etc/nginx/sites-available/vibenote.conf (Debian/Ubuntu style) and enable.
# Replace api.example.com with your domain. Add real TLS cert paths (LetsEncrypt, etc.).

server {
  server_name api.example.com;

  # Listen on 80 and redirect to HTTPS (optional if you terminate TLS elsewhere)
  listen 80;
  listen [::]:80;
  return 301 https://$host$request_uri;
}

server {
  server_name api.example.com;
  listen 443 ssl http2;
  listen [::]:443 ssl http2;

  # ssl_certificate /etc/letsencrypt/live/api.example.com/fullchain.pem;
  # ssl_certificate_key /etc/letsencrypt/live/api.example.com/privkey.pem;
  # include /etc/letsencrypt/options-ssl-nginx.conf;
  # ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

  # Basic security headers (add CSP/etc. on frontend domain layer if needed)
  add_header X-Frame-Options SAMEORIGIN;
  add_header X-Content-Type-Options nosniff;
  add_header Referrer-Policy no-referrer-when-downgrade;

  # Upstream Node server (PM2) on localhost
  location /v1/ {
    proxy_pass http://127.0.0.1:8787/v1/;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Connection "";
    proxy_buffering off;
  }

  # Health endpoint fast path (optional microâ€‘cache)
  location = /v1/healthz {
    proxy_pass http://127.0.0.1:8787/v1/healthz;
    expires -1;
  }

  # Optional gzip (JSON responses are small, so this is fine to disable):
  gzip on;
  gzip_types application/json text/plain application/javascript text/css;
  gzip_min_length 256;
}
